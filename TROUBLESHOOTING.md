# Устранение проблем с Яндекс Музыка клиентом

## Проблема: Отображается кнопка "Попробовать снова" вместо сайта Яндекс.Музыки

Если в релизной версии приложения вместо сайта Яндекс.Музыки отображается кнопка "Попробовать снова", это означает, что возникли проблемы с созданием WebviewWindow.

### Возможные причины и решения:

#### 1. Проблемы с сетевым подключением
**Симптомы:** Приложение не может подключиться к `https://music.yandex.ru`

**Решения:**
- Проверьте подключение к интернету
- Попробуйте открыть `https://music.yandex.ru` в браузере
- Проверьте настройки прокси-сервера
- Отключите VPN временно

#### 2. Блокировка антивирусом или файрволом
**Симптомы:** Приложение запускается, но не может создать WebviewWindow

**Решения:**
- Добавьте приложение в исключения антивируса
- Временно отключите антивирус для тестирования
- Проверьте настройки Windows Defender
- Добавьте приложение в исключения файрвола

#### 3. Проблемы с правами доступа
**Симптомы:** Приложение не может создать окно или получить доступ к системным ресурсам

**Решения:**
- Запустите приложение от имени администратора
- Проверьте права доступа к папке с приложением
- Убедитесь, что у пользователя есть права на создание окон

#### 4. Проблемы с CSP (Content Security Policy)
**Симптомы:** WebviewWindow создается, но не загружает контент

**Решения:**
- Проверьте настройки CSP в `tauri.conf.json`
- Убедитесь, что домены Яндекс.Музыки разрешены в CSP
- Проверьте консоль браузера (F12) на наличие ошибок CSP

#### 5. Проблемы с Tauri API
**Симптомы:** Приложение не может импортировать или использовать Tauri API

**Решения:**
- Пересоберите приложение: `npm run build && cargo tauri build --release`
- Проверьте версии зависимостей в `package.json` и `Cargo.toml`
- Убедитесь, что все зависимости установлены корректно

### Диагностика проблем

#### 1. Проверка логов
Откройте консоль браузера (F12) и проверьте:
- Ошибки JavaScript
- Предупреждения CSP
- Сообщения от диагностических модулей

#### 2. Проверка сетевого подключения
```powershell
# Проверьте доступность Яндекс.Музыки
curl -I https://music.yandex.ru
```

#### 3. Проверка прав доступа
```powershell
# Запустите приложение от имени администратора
Start-Process "src-tauri/target/release/yandex-music-client.exe" -Verb RunAs
```

#### 4. Проверка антивируса
- Временно отключите антивирус
- Добавьте приложение в исключения
- Проверьте логи антивируса на блокировки

### Альтернативные решения

#### 1. Использование iframe fallback
Если WebviewWindow не работает, приложение автоматически попытается использовать iframe.

#### 2. Открытие в браузере
Нажмите кнопку "Открыть в браузере" для доступа к Яндекс.Музыке через браузер.

#### 3. Открытие в отдельном окне
Нажмите кнопку "Открыть в окне" для создания popup окна.

### Сборка с диагностикой

Для сборки приложения с дополнительной диагностикой используйте:

```powershell
# Запустите скрипт сборки
.\build.ps1
```

Скрипт автоматически:
- Проверит наличие всех необходимых инструментов
- Установит зависимости
- Соберет приложение
- Покажет диагностическую информацию

### Отладка в режиме разработки

Для отладки проблем используйте режим разработки:

```bash
npm run tauri dev
```

Это позволит:
- Видеть подробные логи в консоли
- Использовать инструменты разработчика браузера
- Быстро тестировать изменения

### Контакты для поддержки

Если проблемы не решаются:
1. Соберите логи из консоли браузера (F12)
2. Проверьте логи антивируса
3. Создайте issue в репозитории проекта с описанием проблемы

### Полезные команды

```bash
# Очистка и пересборка
npm run clean
npm install
npm run build
cargo tauri build --release

# Проверка зависимостей
npm audit
cargo audit

# Запуск в режиме разработки
npm run tauri dev

# Сборка релизной версии
cargo tauri build --release
```

# Журнал изменений

## [0.1.1] - 2025-01-07

### Исправлено
- **Критическая проблема**: Отображение кнопки "Попробовать снова" вместо сайта Яндекс.Музыки в релизной версии
- Улучшена обработка ошибок создания WebviewWindow
- Добавлена система повторных попыток (до 3 раз) при создании WebviewWindow
- Увеличен таймаут создания WebviewWindow с 10 до 15 секунд
- Добавлена проверка доступности Tauri API перед созданием WebviewWindow

### Добавлено
- **Новый fallback механизм**: Автоматическое переключение на iframe при проблемах с WebviewWindow
- **Улучшенная диагностика**: Детальные логи для отладки проблем в релизной версии
- **Новый файл `webview-fallback.ts`**: Специализированный модуль для обработки fallback сценариев
- **Обновленная CSP конфигурация**: Расширенные разрешения для доменов Яндекс.Музыки
- **Скрипт сборки `build.ps1`**: Автоматическая проверка зависимостей и сборка с диагностикой
- **Файл `TROUBLESHOOTING.md`**: Подробные инструкции по устранению проблем
- **Файл `QUICK_FIX.md`**: Быстрые решения для критических проблем

### Улучшено
- **Пользовательский интерфейс**: Более информативные сообщения об ошибках с вариантами решения
- **Индикатор загрузки**: Анимированный спиннер во время создания WebviewWindow
- **Обработка ошибок**: Многоуровневая система fallback (WebviewWindow → iframe → сообщение об ошибке)
- **Диагностика**: Расширенная система логирования для релизной версии
- **Документация**: Обновлен README.md с информацией о решении проблем

### Технические изменения
- Обновлен `main.ts`: Добавлена проверка Tauri API и система повторных попыток
- Обновлен `tauri.conf.json`: Расширена CSP для лучшей совместимости
- Обновлен `release-debug.ts`: Добавлена проверка WebviewWindow API
- Создан `webview-fallback.ts`: Новый модуль для fallback механизмов
- Обновлен `build.ps1`: Автоматическая проверка зависимостей и диагностика

### Решение проблемы
Проблема с отображением кнопки "Попробовать снова" возникала из-за:
1. Недостаточного таймаута для создания WebviewWindow
2. Отсутствия проверки доступности Tauri API
3. Недостаточной обработки ошибок создания окна
4. Ограниченной CSP конфигурации

**Новое поведение:**
1. Показывается индикатор загрузки
2. Выполняется до 3 попыток создания WebviewWindow
3. При неудаче автоматически переключается на iframe
4. Если iframe недоступен, показывается информативное сообщение с вариантами решения

### Файлы для тестирования
- `src-tauri/target/x86_64-pc-windows-msvc/release/yandex-music-client.exe` (4.74 MB)
- Размер приложения: 4.74 MB
- Время сборки: ~2 минуты

### Инструкции по тестированию
1. Запустите собранное приложение
2. Проверьте загрузку Яндекс.Музыки
3. Если появляется кнопка "Попробовать снова", следуйте инструкциям в `QUICK_FIX.md`
4. Откройте консоль браузера (F12) для просмотра диагностических сообщений

### Известные проблемы
- В некоторых случаях антивирус может блокировать создание WebviewWindow
- При проблемах с сетью может потребоваться использование альтернативных кнопок
- В корпоративных сетях могут быть ограничения на создание окон

### Следующие шаги
- Мониторинг проблем в релизной версии
- Сбор обратной связи от пользователей
- Дальнейшая оптимизация fallback механизмов
